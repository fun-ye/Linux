# Chapter 6 存储结构与磁盘划分

[TOC]



## 6.1 一切从“/”开始

<img src="C:\Users\方也\AppData\Roaming\Typora\typora-user-images\image-20200312104540666.png" alt="image-20200312104540666" style="zoom: 67%;" />

表6-1                 Linux系统中常见的目录名称以及相应内容

| 目录名称    | 应放置文件的内容                                             |
| ----------- | ------------------------------------------------------------ |
| /boot       | 开机所需文件—内核、开机菜单以及所需配置文件等                |
| /dev        | 以文件形式存放任何设备与接口                                 |
| /etc        | 配置文件                                                     |
| /home       | 用户主目录                                                   |
| /bin        | 存放单用户模式下还可以操作的[命令](https://www.linuxcool.com/) |
| /lib        | 开机时用到的函数库，以及/bin与/sbin下面的命令要调用的函数    |
| /sbin       | 开机过程中需要的命令                                         |
| /media      | 用于挂载设备文件的目录                                       |
| /opt        | 放置第三方的软件                                             |
| /root       | 系统管理员的家目录                                           |
| /srv        | 一些网络服务的数据文件目录                                   |
| /tmp        | 任何人均可使用的“共享”临时目录                               |
| /proc       | 虚拟文件系统，例如系统内核、进程、外部设备及网络状态等       |
| /usr/local  | 用户自行安装的软件                                           |
| /usr/sbin   | Linux系统开机时不会使用到的软件/命令/[脚本](https://www.linuxcool.com/) |
| /usr/share  | 帮助与说明文件，也可放置共享文件                             |
| /var        | 主要存放经常变化的文件，如日志                               |
| /lost+found | 当文件系统发生错误时，将一些丢失的文件片段存放在这里         |

路径：绝对路径指的是从根目录（/）开始写起的文件或目录名称，而相对路径则指的是相对于当前路径的写法。

## 6.2 物理设备的命名规则

表6-2                       常见的硬件设备及其文件名称

| 硬件设备      | 文件名称           |
| ------------- | ------------------ |
| IDE设备       | /dev/hd[a-d]       |
| SCSI/SATA/U盘 | /dev/sd[a-p]       |
| 软驱          | /dev/fd[0-1]       |
| 打印机        | /dev/lp[0-15]      |
| 光驱          | /dev/cdrom         |
| 鼠标          | /dev/mouse         |
| 磁带机        | /dev/st0或/dev/ht0 |

硬盘分区：主分区或扩展分区的编号从1开始，到4结束；逻辑分区从编号5开始。

<img src="C:\Users\方也\AppData\Roaming\Typora\typora-user-images\image-20200312143640959.png" alt="image-20200312143640959" style="zoom:67%;" />

<img src="C:\Users\方也\AppData\Roaming\Typora\typora-user-images\image-20200312151027333.png" alt="image-20200312151027333" style="zoom:50%;" />

>所谓扩展分区，严格地讲它不是一个实际意义的分区，它仅仅是一个指向下一个分区的指针，这种指针结构将形成一个单向链表。

<img src="C:\Users\方也\AppData\Roaming\Typora\typora-user-images\image-20200312151118239.png" alt="image-20200312151118239" style="zoom:67%;" />

## 6.3 文件系统与数据资料

常见文件系统：

> **Ext3**：是一款日志文件系统，能够在系统异常宕机时避免文件系统资料丢失，并能自动修复数据的不一致与错误。
>
> **Ext4**：Ext3的改进版本，作为RHEL 6系统中的默认文件管理系统，它支持的存储容量高达1EB（1EB=1,073,741,824GB），且能够有无限多的子目录。另外，Ext4文件系统能够批量分配block块，从而极大地提高了读写效率。
>
> **XFS**：是一种高性能的日志文件系统，而且是RHEL 7中默认的文件管理系统，它的优势在发生意外宕机后尤其明显，即可以快速地恢复可能被破坏的文件，而且强大的日志功能只用花费极低的计算和存储性能。并且它最大可支持的存储容量为18EB，这几乎满足了所有需求。

super block:记录着整个文件系统的信息,每个文件的权限与属性记录在inode中，而且每个文件占用一个独立的inode表格，该表格的大小默认为128字节

文件的实际内容则保存在block块中（大小可以是1KB、2KB或4KB）

VFS（Virtual File System，虚拟文件系统）接口

<img src="C:\Users\方也\AppData\Roaming\Typora\typora-user-images\image-20200312151928636.png" alt="image-20200312151928636" style="zoom:70%;" />

## 6.4 挂载硬件设备

mount 文件系统 挂载目录  （数据/设备跟目录文件相关联）

表6-3                       mount命令中的参数以及作用

| 参数 | 作用                                 |
| ---- | ------------------------------------ |
| -a   | 挂载所有在/etc/fstab中定义的文件系统 |
| -t   | 指定文件系统的类型                   |

```
# mount /dev/sdb2 /backup
```

硬件设备和目录永久地进行自动关联:  填写格式“设备文件 挂载目录 格式类型 权限选项 是否备份 是否自检”写入到/etc/fstab文件中

| 字段     | 意义                                                         |
| -------- | ------------------------------------------------------------ |
| 设备文件 | 一般为设备的路径+设备名称，也可以写唯一识别码（UUID，Universally Unique Identifier） |
| 挂载目录 | 指定要挂载到的目录，需在挂载前创建好                         |
| 格式类型 | 指定文件系统的格式，比如Ext3、Ext4、XFS、SWAP、iso9660（此为光盘设备）等 |
| 权限选项 | 若设置为defaults，则默认权限为：rw, suid, dev, exec, auto, nouser, async |
| 是否备份 | 若为1则开机后使用dump进行磁盘备份，为0则不备份               |
| 是否自检 | 若为1则开机后自动进行磁盘自检，为0则不自检                   |

```
# vim /etc/fstab
# /dev/sdb2 /backup  ext4 deddaults 0 0
//卸载设备文件
# umount /dev/sdb2
```

## 6.5 添加硬盘设备

一块新的硬盘存储设备，然后再进行分区、格式化、挂载等操作

1. fdisk命令

   fdisk [磁盘名称]” //交互式

| 参数 | 作用                   |
| ---- | ---------------------- |
| m    | 查看全部可用的参数     |
| n    | 添加新的分区           |
| d    | 删除某个分区信息       |
| l    | 列出所有可用的分区类型 |
| t    | 改变某个分区的类型     |
| p    | 查看分区表信息         |
| w    | 保存并退出             |
| q    | 不保存直接退出         |

格式化：

```
# mkfs.xfs /dev/sdb1
```

2. du命令

“du [选项] [文件]”---查看文件数据占用量

```
# du -sh /newFS/    // -sh /*命令来查看在Linux系统根目录下所有一级目录分别占用的空间大小
```

## 6.6 添加交换分区

SWAP（交换）分区是一种通过在硬盘中预先划分一定的空间，然后将把内存中暂时不常用的数据临时存放到硬盘中，以便腾出物理内存空间让更活跃的程序服务来使用的技术，其设计目的是为了解决真实物理内存不足的问题。

> 在生产环境中，交换分区的大小一般为真实物理内存的1.5～2倍

```
# mkswap /dev/sdb2		//格式化命令mkswap，对新建的主分区进行格式化操作
# swapon /dev/sdb2		//SWAP分区设备正式挂载到系统中
# free -m 				//查看交换分区的大小变化
```

## 6.7 磁盘容量配额

> quota命令进行磁盘容量配额管理，从而限制用户的硬盘可用容量或所能创建的最大文件个数

- 软限制：当达到软限制时会提示用户，但仍允许用户在限定的额度内继续使用。

- 硬限制：当达到硬限制时会提示用户，且强制终止用户的操作。

1. xfs_quota命令

   “xfs_quota [参数] 配额 文件系统” -c参数用于以参数的形式设置要执行的命令；-x参数是专家模式

```
# xfs_quota -x -c 'limit bsoft=3m bhard=6m isoft=3 ihard=6 tom' /boot
# xfs_quota -x -c report /boot
```

2. edquota命令

edquota [参数] [用户] ---编辑用户的quota配额限制

> u参数表示要针对哪个用户进行设置；-g参数表示要针对哪个用户组进行设置

```
# edquota -u tom
```

## 6.8 软硬方式链接

- **硬链接（hard link）：**为一个“指向原始文件inode的指针”，系统不为它分配独立的inode和文件。每增加一个hard link,incode连接数增加1，只有Incode连接数为0，才彻底删除。

- **软链接（也称为符号链接[symbolic link]）：**仅仅包含所链接文件的路径名，因此能链接目录文件，也可以跨越文件系统进行链接。但是，当原始文件被删除后，链接文件也将失效，

**ln命令**

用于创建链接文件，格式为“ln [选项] 目标”

| 参数 | 作用                                               |
| ---- | -------------------------------------------------- |
| -s   | 创建“符号链接”（如果不带-s参数，则默认创建硬链接） |
| -f   | 强制创建文件或目录的链接                           |
| -i   | 覆盖前先询问                                       |
| -v   | 显示创建链接的过程                                 |

```
# ln -s readme.txt redeit.txt
```

