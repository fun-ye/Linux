#  Chapter 5 用户身份与文件权限

[TOC]



## 5.1 用户身份与能力

>管理员UID为0：系统的管理员用户。
>
>系统用户UID为1～999： Linux系统为了避免因某个服务程序出现漏洞而被黑客提权至整台服务器，默认服务程序会有独立的系统用户负责运行，进而有效控制被破坏范围。
>
>普通用户UID从1000开始：是由管理员创建的用于日常工作的用户。

1. useradd 命令

  “useradd [选项] 用户名”

| 参数 | 作用                                     |
| ---- | ---------------------------------------- |
| -d   | 指定用户的家目录（默认为/home/username） |
| -e   | 账户的到期时间，格式为YYYY-MM-DD.        |
| -u   | 指定该用户的默认UID                      |
| -g   | 指定一个初始的用户基本组（必须已存在）   |
| -G   | 指定一个或多个扩展用户组                 |
| -N   | 不创建与用户同名的基本用户组             |
| -s   | 指定该用户的默认Shell解释器              |

```
# useradd -d /home/linux -u 8888 -s /sbin/nologin linuxpro
# id linuxpro
```

 2. groupadd命令

   ```
   #groupadd ronny
   ```

 3. usermod命令

| 参数  | 作用                                                         |
| ----- | ------------------------------------------------------------|
| -c    | 填写用户账户的备注信息                                       |
| -d -m | 参数-m与参数-d连用，可重新指定用户的家目录并自动把旧的数据转移过去 |
| -e    | 账户的到期时间，格式为YYYY-MM-DD                             |
| -g    | 变更所属用户组                                               |
| -G    | 变更扩展用户组                                               |
| -L    | 锁定用户禁止其登录系统                                       |
| -U    | 解锁用户，允许其登录系统                                     |
| -s    | 变更默认终端                                                 |
| -u    | 修改用户的UID                                                |

```
# usermod -G root linuxprobe
# usermod -u 8888 linuxprobe
```

 4. passwd命令

| 参数    | 作用                                                       |
| ------- | ----------------------------------------------------------|
| -l      | 锁定用户，禁止其登录                                         |
| -u      | 解除锁定，允许用户登录                                       |
| --stdin | 允许通过标准输入修改用户密码，如echo "NewPassWord" \| passwd --stdin Username |
| -d      | 使该用户可用空密码登录系统                                   |
| -e      | 强制用户在下次登录时修改密码                                 |
| -S      | 显示用户的密码是否被锁定，以及密码所采用的加密算法名称       |

```
# passwd
# passwd linxpro
```

 5. userdel命令

| 参数 | 作用                     |
| ---- | ------------------------ |
| -f   | 强制删除用户             |
| -r   | 同时删除用户及用户家目录 |

```
# userdel -r linuxpro
```

## 5.2 文件权限与归属

> -：普通文件。
>
>d：目录文件。
>
>l：链接文件。
>
>b：块设备文件。
>
>c：字符设备文件。
>
>p：管道文件。

对目录文件来说，“可读”表示能够读取目录内的文件列表；“可写”表示能够在目录内新增、删除、重命名文件；而“可执行”则表示能够进入该目录。

<img src="C:\Users\方也\AppData\Roaming\Typora\typora-user-images\image-20200311194320137.png" alt="image-20200311194320137" style="zoom: 67%;" />

<img src="C:\Users\方也\AppData\Roaming\Typora\typora-user-images\image-20200311194508833.png" alt="image-20200311194508833" style="zoom:67%;" />

## 5.3 文件的特殊权限

1. SUID

SUID是一种对二进制程序进行设置的特殊权限，可以让二进制程序的执行者临时拥有属主的权限（仅对拥有执行权限的二进制程序有效）。

2. SGID

   >让执行者临时拥有属组的权限（对拥有执行权限的二进制程序进行设置）；
   >
   >在某个目录中创建的文件自动继承该目录的用户组（只可以对目录进行设置）。

```
# chmod -Rf g+s testdir/	// -R递归改变权限
# chmod 760 test		//chmod [参数] 权限 文件或目录名称
# chown root:bin test	//chown [参数] 所有者:所属组 文件或目录名称”
```

3. SBIT

SBIT特殊权限位可确保用户只能删除自己的文件，而不能删除其他用户的文件

```
# mkdir linux
# chmod -R o+t linux/
```

## 5.4 文件的隐藏属性

1. chattr命令

   “chattr [参数] 文件”

| 参数 | 作用                                                         |
| ---- | ------------------------------------------------------------ |
| i    | 无法对文件进行修改；若对目录设置了该参数，则仅能修改其中的子文件内容而不能新建或删除文件 |
| a    | 仅允许补充（追加）内容，无法覆盖/删除内容（Append Only）     |
| S    | 文件内容在变更后立即同步到硬盘（sync）                       |
| s    | 彻底从硬盘中删除，不可恢复（用0填充原文件所在硬盘区域）      |
| A    | 不再修改这个文件或目录的最后访问时间（atime）                |
| b    | 不再修改文件或目录的存取时间                                 |
| D    | 检查压缩文件中的错误                                         |
| d    | 使用dump命令备份时忽略本文件/目录                            |
| c    | 默认将文件或目录进行压缩                                     |
| u    | 当删除该文件后依然保留其在硬盘中的数据，方便日后恢复         |
| t    | 让文件系统支持尾部合并（tail-merging）                       |
| x    | 可以直接访问压缩文件中的内容                                 |

```
[root@linuxprobe ~]# chattr +a linuxprobe
[root@linuxprobe ~]# rm linuxprobe
```

2. lsattr命令

```
# lsattr linuxprobe
```

## 5.5 文件访问控制列表(fACL)

对某个**指定的用户**进行单独的权限控制--ACL

1. setfacl命令

```
   # setfacl -Rm u:linuxprobe:rwx /root //R递归 m 普通文件 b 删除
```

2. getfacl 命令  

   用于显示文件上设置的ACL信息
```
# getfacl /root
```

## 5.6 su命令与sudo服务

sudo命令用于给普通用户提供额外的权限来完成原本root管理员才能完成的任务

| 参数             | 作用                                              |
| ---------------- | -------------------------------------------------|
| -h               | 列出帮助信息                                       |
| -l               | 列出当前用户可执行的命令                             |
| -u 用户名或UID值 | 以指定的用户身份执行命令                             |
| -k               | 清空密码的有效时间，下次执行sudo时需要再次进行密码验证 |
| -b               | 在后台执行指定的命令                                |
| -p               | 更改询问密码的提示语                                |

visudo:在配置用户权限时将禁止多个用户同时修改sudoers配置文件，还可以对配置文件内的参数进行语法检查，并在发现参数错误时进行报错。

> 只有root管理员才可以使用visudo命令编辑sudo服务的配置文件。
